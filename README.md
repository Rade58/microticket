# CROSS SERVICE DATA REPLICATION IN ACTION

NAS `tickets` MICROSERVICE INA A GOOD SPOT, **MI CEMO SE MORATI VRATITI NA tickets MICROSERVICE, NESTO KASNIE, KAOKO BI SMO DODALI SOME STUFF FOR HANDLING CONCURRENCY-JA; I HANDLING COUPLE OTHER EVENTS**

MI CEMO SE SADA BAVITI DEVELOPING-OM `orders` MICROSERVICE-A

SERVICE CE SE SASTOJATI OD LOGIKE ZA CREATING ORDER-A, NJEGOV UPDATING, AND PAYING FOR IT EVENTUALLY

SA UI STRANE, KOJI CU EVENTUALLY NAPRAVITI, IMAO BI CLICKING ON TICKET IN ORDER TO PURCHASE IT; KORISNIK CE ONDA BITI TAKEN TO A PAGE SINGLE TICKETA, GDE MOZE DA PRITISNE NA PURCHASE BUTTON

ONDA CE KORISNIKU PISATI KOLIKO IMA VREMENA DA PURCHESUJE TICKET, UZ STA CE IMATI I PAY BUTTON

TAJ TIME BICE TIME ZA KOJI JE LOCK-OVAN TICKET I NECE MOCI NIKO DRUGI DA GA KUPI

DAKLE EVENTUALLY I TO MOZE DA EXPIRE-UJE, NAKON CEGA CE TICKET PONOVO BITI OTKLJUCAN ZA KUPOVINU 

`Order` DOKUMENT, KOJI BUDEM STORE-OVAO U DATABASE CE IMATI OVE FIELD-OVE:

`userId` -> **KORISNIK KOJI JE KREIRAO ORDER, ODNONO KORISNIK KOJI POKUSAVA DA PURCHASE-UJE TICKET**

`ststus` -> **MOGUCE VREDNOSTI: `"expired"`, `"paid"`, `"pending" (AWAITING PAYMENT)`**

`expiresAt` -> **TIME AT WICH ORDER EXPIRES (USER HAS 15 MINUTES TO PAY)**

`ticketId` -> **ID OF THE TICKET, USER IS TRYING TO BUY**

## UMESTO DA `orders` MICROSERVICE IMA CELI TICKETS DATABASE, ON CE `REPLICATE-OVATI, SOME INFORMATION IZ tickets MICROSERVICE-A`

DAKLE DATABASE, TIED TO orders MICROSERVICE CE IMATI DVE KOLEKCIJE: `Orders` I `Tickets`

VEC SAM TI REKAO STA MOZE IMATI `Order` DOKUMENT OD FIELD-OVA

A `Tickets` MICROSERVICE CE IMATI OVE FIELD-OVE: `price`, `title` I STO JE JAKO VAZNO ZA CONCURRENCY ISSUES, IMACE I `version` FIELD 

***

NARAVNO TAJ field CE IMATI DOKUMENT I U tickets MICROSERVICE-U

***

## ZATO STO ZELIMO DA REPLICATE-IIJEMO ODREDJENI DATA `tickets` MICROSERVICE, `order` MICROSERVICE NEEDS TO LISTEN TO TWO KINDS OF EVENTS: `"tickets:created"` I `"tickets:updated"`

A SA EVENT-OVIMA PORED OSTALIH PODATKA TICKET-A, BICE POSLAT I `version` FIELD

KAO STO SMO VEC REKLI KADA SMO GOVORILI O CONCURRENCY-JU, MORACEMO PAZITI O ORDERU EVENT-OVA, PO KOJEM CE SE ONI PROCESS-OVATI, DA NE BI DOSLO O **PROBLEMU PO KOJEM BI SE MOZDA ZBOG LATENCY-JA PRVO PROCESS-OVAO EVENT, KOJI JE EMMITED KASNIJE OD ONOG, KOJI NIJE STIGAO DA BUDE PROCESSES**

ZATO UZ POMOC `version` FIELD-A MI CEMO POKUSATI DA RESIMO TAKAV PROBLEM

***






