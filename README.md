# UNDERSTANDING EVENT FLOW

`orders` MICROSERVICE CE PUBLISH-OVATI EVENTS TO `"order:created"` I `"order:canceled"` KANALE

**A JA CU IMATI JOS DVA MICROSERVICA, KOJE ZANIMAJU NEKI OD POMENUTIH KANALA; TO SU `payments` MICROSERVICE I `expiration` MICROSERVICE**

**MEDJUTIM I SAMI `tickets` MICROSERVICE CE ZANIMATI, NEKI OD POMENUTIH KANALA**

# "`order:created`"

***

`payments` TREBA DA BUDE SUBSCRIBED NA `"order:created"`, KAKO BI STORE-OVAO TAJ ORDER, JER USER MIGHT SUBMIT PAYMENT FOR THAT ORDER

ALI `JEDAN ORDER SE SASTOJI OD DOKUMENTA NA KOJEM TI NEMAS INFORMACIJU U price-U ILI title-U`

TU JE NARAVNO `price` CRITICAL JER KAKO DA SE IZVRSI PAYMENT AKO NEMA price-A

**UPRAVO ZATO MOJ `orders` MICROSERVICE QUERY-UJE DVE KOLEKCIJE U, SVOM DATABASE-U, A TO SU `Orders` I `Tickets`** (**`ZATO SI I KORISTIO ref, ODNOSNO populate, DA BI QUERY-UJUCI ZA Order, TI DOBIO I RELATED Ticket DOKUMENT IZ DATBASE-A`**)

***

`expiration` MICROSERVICE, TREBA DA ZANA ZA EXPIRATION TIME ORDERA, KAKO BI STARTOV TIMER, UZIMAJUCI `expirationOrder` FIELD SA Order-A, **TAKO DA CE I, POMENUTI MICROSERVICE ON SLUSATI NA `"order:created"`** 

***

`tickets` MICROSERVICE MORA DA DOBIJE, POMENUTI EVENT KAKO BI, NEKAKO ZAKLJUCAO ODREDJENI TICKET, KAKO ON VISE NE BI MOGAO BITI EDITED

**ZAMISLI SLUCAJ GDE USER TREBA DA PURCH-ASUJE TICKET KOJI KOSTA 20 DOLARA, A ODMAH NAKON TOGA NEKO EDIT-UJE TICKET, I PODESI GA 200$** (E PA OVO ZELIS DA PREVENT-UJES)

# `"order:cancelled"`

`tickets` MORA DA SLUSA OVAJ EVENT, KAKO BI, NEKAKO OTKLJUCAO TICKET, JER ON VISE NIJE U STATUSU OTHER THAN CANCELLED

***

`payment` SERVICE MORA DA ZNA, KAKO BI REJECT-OVAO ANY PAYMENT ZA ORDER, KOJI JE CANCELLED

# JA CU U SLEDECIM BRANCH-EVIMA, U MOM `/common` MODULU ([@ramicktick/common](https://www.npmjs.com/package/@ramicktick/common)) DEFINISATI SVU TU LOGIKU VEZANU ZA NOVE EVENTS
