# SOLVING CONCURRENCY ISSUES

OVO JE ISTO EKSTENZIVNO, I ZATO NECU SVE ZAPISIVATI

POGLEDAJ VIDEO `14-18` KOJEG SAM OSTAVIO I NA GOOGLE CLOUD-U

GLAVNA STVAR:

**NECES SA NATS STREAMING SERVEROM DA RESAVAS CONCURRENCY ISSUES, JER ON ZA TO I NIJE NI DIZAJNIRAN; RESAVACES GA TAKO STO CES REDIZAJNIRATI TVOJE MICROSERVICE-E**

SAZETO OBJASNJENJE ZA FLOW:

1. IDEJA JE DA SE HIT-UJE TRANSACTION MICROSERVICE, KOJI IMA SVO DATBASE I STORE-UJE TRANSACTION DAJUCI JOJ REDNI BROJ

2. TRANSACTION SERVICE CE BITI ODGOVORAN DA POSALJE KAO EVENT NA NEKI KANAL, TAJ DATA KOJI CE U SEBI IMATI TAJ REDNI BROJ

3. NATS NARAVNO PROSLEDJUJE EVENT IZ TOG KANALA NA LISTENERE KOJI SU SUBSCRIBED

4. 1. IDELANO NECE DOCI DO NIKAKVOG LATENCY-JA, IL IDA NEC DOCI DO CRACHINGA NEKE KOPIJE TVOG MICROSERVICE-A, FOR SOME REASON

ODNOSNO NI JEDNA KOPIJA TVOG MICROSERVICE-A NECE BITI OMETENA, ISVE CE SE STORE-OVTI PO REDU

4. 2. U SLUCAJU DA CE DOCI DO LATENCY-JA, DA CE DOCI DO CRACHINGA KOPIJE TVOG MICROSERVICE-A

DA JEDNA KOPIJA MICROSERVICE-A, KOJI JE SUBSCRIBED NA EVENT USTVARI FAIL-UJE, A DA JE ISSUED EVENT, POSLE TOG KOJI NE MOZE PROCI, I DA JE PROSSAO TAJ NOVO ISSUED EVENT DESILO BI SE SLEDECE

BIO BI PROVEREN BROJ TRANSAKCIJE KOJI BI BIO STORED U DATBASE-U ZA TA JMICROSERVICE

AKO TAJ BROJ NIJE ZA JEDAN VECI OD POSLEDNJEG BROJA TRANSAKCIJE, MI NE BISKO AKNOWLEDGOVALI (msg.ack()), I OPET BI SE DESIO TAJ 'BOUNCING' PO KOJEM CE OPET NTS STREAMING SERVER NAKON 30 SEKUNDI POKUSTATI SLANJE, I TADA AKO JE MREZA OK, PROCI CE EVENT I OPET CE SE PROVERITI TRANSACTION NUMBER, KOJI CE MOZDA BITI IN RIGHT ORDERU I TAKO CE SE USPESNO STORE-OVATI STO JE TREBALO, I TO MOZE DA SE IZVRSI (msg.ack())  

**DAKLE VAZNA STVAR JE `LAST TRASACTION NUMBER` KOJI BI BIO STORED U DATBASE-U MICROSERVICE-A LISTENER-A**
