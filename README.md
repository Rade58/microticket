# BUILDING AN IMAGE IN A GITHUB ACTION

SADA CEMO SAGRADITI NAS PRVI WORKFLOW, KOJIM CEMO SE POSTARATI DA SE BUILD-UJE IMAGE FOR THE `auth` MICROSERVICE; DA SE ON ONDA PUSH-UJE TO DOCKER HUB; I OSTALO

DAKLE OPET IDEMO NA NAS REPO NA GITUB-U I BIRAMO `Actions` TAB; I KLIKCEMO NA `New Workflow` PA KLIKNI DA `set up a workflow yourself`

IZBRISI SAV CODE KOJI JE VEC TAMO BIO DEFINISAN I ZADAJ IME ZA WORKFLOW DA BUDE `deploy-auth.yml`

SADA CEMO PISATI CONFIIG KOJI CE DICTATE-OVATI KADA CE SE RUNN-OVATI, I STA CE EXACTLY RADITI

EVO TI ZA POCETAK DEFINISEMO DA SE ACTION RUNN-UJE SAMO AAKO SE DESILA PROMENA U `auth` FOLDERU

**ALI VIDECES DA SAM DEFINISAO DA SE ACTION OBVLJA ZA `push` RELATED TO `main` BRANCH**

`deploy-auth.yml`:

```yml
name: deploy-auth

on:
  push:
    branches:
      - main
    paths:
      - 'auth/**'
```

**ZASTO `push`?**

**PA KADA GOD MI CLOSE-UJEMO ILI MERGE-UJMO PULL REQUEST; THAT COUNTS AS A `push` DIRECTLY TO THE `main` BRANCH** (**`D TO POTPUNO IMA SMISLA`**)

DAKLE CHECK KOJ ISAM PODESIO RUNN-OVCE POMENUTI WORKFLOW ,SVAKI PUT KADA MERGE-UJEMO PULL REQUEST INTO THE MASTER BRANCH

A RUNN-OVACE SE SAMO AKO POSTOJI CHANE U `auth` FOLDERU

SADA CEMO DA DODAMO JOBS

`deploy-auth.yml`:

```yml
name: deploy-auth

on:
  push:
    branches:
      - main
    paths:
      - 'auth/**'
# EVO, OVO DODAJEM
# ZADAJEM MU IME build
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
# OVO ZNACI CHECKOUT ALL OF OUR CODE INSIDE OF OUR REPO
      - uses: actions/checkout@v2
# SADA DEFINISEMO KOMANDE KOJE CE SE RUNN-OVATI
# SAMO DA TI KAZEM DA ubuntu-latest DOLAZI SA PREINSTALLED 
# DOCKEROM, TAKO DA TU INSTALACIJU INSIDE COMMAND, NE MORAS
# DEFINISATI 
      # mt MI JE SKARACENO ZA microticket (TO MI JE NAJLOGICNIJE DA SMISLIM)      
      - run: 'cd auth && docker build -t radebajic/mt-auth . && docker push radebajic/mt-auth'

# NAKON STO SE BUILD-UJE IMAGE, TREBA DA SE PUSH-UJE TO DOCKER 
# HUB
# ALI MORAS BITI LOGGED IN INTO DOCKER CLI; DAKLE DOCKER CLI MORA ZNATI
# KO SI TI ZAPRAVO, DA BI SME DA PUSH-UJES TO DOCKER HUB
# ALI PROBLEM JE ST OSE SCRIPT NECE EXECUTE-OVATI NA MOJOJ LIKALNOJ
# MACHINE, VEC U CONTAINERU KOJI MANGE-UJE GITHUB GITHUB-A
# MORAMO NEKAKO RECI DOCKERU DA ME LOGG-UJE KORISTECI
# MOJE IME I PASSWORD
# NECEMO IME I SIFRU UNOSITI DIREKTNO U SCRIPT OVDE
# VEC CEMO DODATI USER NAME I PASSWORD, KO SECRET
```
