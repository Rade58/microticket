# REMINDER ON VERSIONING RECORDS

DAKLE IMAS `tickets` MICROSERVICE SA JEDNE STRANE A `orders` MICROSERVICE S DRUGE TRANE

**TICKET BI SE NAPRAVIO I ON BI SE U DATBASE-U RELATED TO tikets MICROSERVICE, STORE-OVAO U Tickets KOLEKCIJI, `ALI BI JOS JEDAN FIELD NA DOKUMENTU BIO INCLUDED TO JE version`**

FRESHLY CREATED DOKUMENT BI IMAO `version` SA VREDNOSCU `1`

NAKON TOG SAVINGA U DATBASEU, BIO BI POSLAT EVENT, I TU NISTA NIJE SPORNO, JER SMO TO RADILI, **ALI BI TAKODJE POSLALI I version KAO DATA, A POMENUTIM EVENTOM**

# MI BI CHECK-OVALI, ODNOSNO PROVERAVLI TAJ VERSION NA LISTENER STRANI

ZA SLUCAJ LISTENINGA, KADA JE U PITANJU DATA FRESHLY CREATED DOKUMENTA, TO NE MORAMO NI RADITI, JER KADA SE PRVI PUT RADI DATA REPLICATION ZA FRESHLY CREATED DOKUMENT ON IMA version SA VREDNOSCU 1

# DAKLE KADA SE RADI DATA REPLICATION ZA SLUCAJ KADA UPDATE-UJES TI BI PROVERAVO `version` DOKUMENTA NA LISTENER STRANI, SA version-OM, KOJI JE NA EVENT-U; I AKO BI TAJ `version` BIO VECI ZA `VISE OD` `1`, TI SI U PROBLEMU, JER SE DESIO NEKI CONCURRENCY PROBLEM

NEKA INSTANCA MICROSERVICE-A JE CRACH-OVALA, ILI IZGUBILA KONEKCIJU NA NATS ILI NESTI SLICNO

ALI POSTO IMAS INVALID `version`, KOJI NIJE ZA JEDAN VECI, OD TRENUTNOG `versiona` REOLICATED DOKUENTA, **TI NE BI PROCESS-OVAO EVENT, A TAKODJE NE BI `acknowladge`-OVAO DO NATS STREAMING SERVER-A (NISAM POZVAO `msg.ack()`), DA JE EVENT PROCESSED**, `A NATS POKUSAVA DA RESEND-UJE ISTI EVENT, NAKON ODREDJENOG PERIODA`

DAKLE TVOJ MICROSERVICE BI CEKAO NA RIGHT EVENT, SA RIGHT VERSIONOM

I TIME IZBEGAVAS CONCURRENCY PROBLEME

## NARAVNO SAM ZI ZAKLJUCIO DA SE `version` TREBA INCRMENTIRATI

TO RADIS PRI SVAKOM UPDATINGU NEKOM DOKUMENTA U DATBASE-U

## AKO TI NIJE JASNO STA SAM MISLIO DA KAXEM POGLEAJ VIDEO 19-11

# ISTO TAKO MONGODB I MONGOOSE RADI TAJ VERSIONING OUT OF THE BOX, JER AKO SI PRIMETIO SVAKI DOKUMENT MONGO-A IMA `__v` PROPERTI

