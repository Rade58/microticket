# HANDLING PUBLISH FAILIRE

U PREDHODNOM BRANCH-U SAM TI PREDSTAVIO PROBLEM KOJI MOZE BITI PROUZROKOVN KADA SE NE BI NISTA RADILO ON EVENT PUBLISHING FAILIRE

REKAO SAM TI I DA JE RESENJE USTVARI STORING EVENTA PRE NEJGOVOG PUBLISHING-A 

AKO IMAS NEKI `trnsaction` MICROSERVICE, I TAJ MICROSERVICE TAKODJE IMA DATABASE

I U TOM DATBASE-U SE CUVAJU SVE TRANSACTIONS; ODNOSNO U TOM DATBASE-U POSTOJI `Transactions` KOLEKCIJA

**ALI JOS VAZNIJE, U TOM DATNASE-U TREBA DA POSTOJI I `Event` KOLEKCIJA U KOJOJ CE STORE-OVATI EVENT**

`DAKLE SIMULTANO U ISTI DATASE, RELATED TO MICROSERVICE, TI CES STORE-OVATI DATA, ALI CES STORE-OVATI I EVENT`

**NA STORED Event DOKUMENTU TRBA DA POSTOJI NEKI FLAG, KOJI CE RECI DA LI JE EVENT PUBLISHED ILI NIJE**

NA PRIMER KADA PRVI PUT STORE-UJES EVENT, DEFINISAO BI DA sent FIELD, ILI `sent` FLAG, DA BUDE `"NO"`)

## ALI MI BI IMALI SEPARATE PROCESS, SOME SEPARATE PICE OF CODE, SOMETHING OUTSIDE OF OUR ROUTE HANDLER, KOJI BI WATCH-OVAO EVENTS, ODNOSNO EVENTS KOLEKCIJU DATNASE-A

IT CAN TAKE NOTE ANY TIME WE SAVE EVENT TO THE DATBASE

**TAJ SEPARATE PIECE OF CODE BI EXTRACT-OVAO TAJ EVENT; ODNOSNO PULL-OVAO GA OUT FROM THAT COLLECTION, I PUBLISHOVAO BI GA TO NATS STREAMING SERVER**

**AKO JE PUBLISHING BIO SUCCESSFUL, ONDA MOZEMO DA UPDATE-UJEMO `sent` FLAG ZA EVENT DOCUMENT U DATBASE-U, KAKO BI ON SADA BIO `"YES"`**

`A AKO NATS BUDE DOWN IL IJE NASA CONNECKIJA SA NATSOM DOEN FOR SOME REASON ?`

E PA ONDA I DALJE Ticket DOKUMENT SAVE-UJEMO U Tickets KOLEKCIJU, ALI SAVE-UJEMO I Event U Events KOLEKCIJU

**ALI TAJ SEPARATE PIECE OF CODE ILI PROCESS ILI WHAT EVER ELSE, CE SE IZVRSITI, KADA SE NATS KONEKCIJA OPET USPOSTAVI; TAJ PIECE OF CODE CE PULL-OVATI IEVENT FROM DATABASE, PA CE GA POSALTI NATSU, A Event DOKUENT CE UPDATE-OVATI, DA MI FLAH `sent` BUDE `"YES"`**

NA PREVAZISAO BI SE PROBLEM PO KOJEM JE DATA SAVED U JEDNOM MICROSERVICE-U, A DRUGI MICROSERVICE NIJE DOBIO EVENT, JER NEMA KOMUNIKACIJE SA EVENT BUSOM; **DAKLE U OVOM SLUCAJU SVI EVENT-OVI POKUSANI A KOJI NISU USPELI, BICE PULLED I REPUBLISHED KADA SE KONEKCIJA PONOVO USPOSTAVI**
