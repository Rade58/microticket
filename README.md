# SETTING UP LOAD BALANCER AND THE REST

MORAM PODESITI ingress-nginx NA MOM CLUSTER-U NA GOOGLE CLOUD-U

OVO BI TREBALO DA BUDE EASY, A GLEDACU U DOKUMENTACIJU ingress-nginx

U DEPLOYMENT SEKCIJI IMA OBJASNJENJE ZA GOOGLE CLOUD

<https://kubernetes.github.io/ingress-nginx/deploy/#gce-gke>

TO TI JE UNDER `GCE-GKE`

NEMOJ NISTA DA EXECUTE-UJES TA TI JE U OKVIRU INFO-A ILI DANGER ZONE-A, TI EXECUTE-UJES ONU `kubectl apply -f <URL>`

NIJE BITNO GDE OVO EXECUTE-UJES U TERMINALU (TO TI GOVORIM JER SI OVO LOKALNO EXECUTE-OVAO U infra/k8s FOLDERU)

- `kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.44.0/deploy/static/provider/cloud/deploy.yaml`

DAKLE INSTALIRAO SAM ingress-nginx NA NASEM GOOGLE CLOUD CLUSTER-U

# SADA MORAM DA UPDATE-UJEM HOST FILE NA MOJOJ LOKALNOJ MACHINE-I, A SADA CU UZETI I SETTOVATI IP CLUSTER-A NA CLOUD-U (USTVARI UZIMAMO IP LOAD BALANCER-A NA CLOUD-U)

VEC SAM TI OBJASNJAVAO OVO, MAPP-OVACU ODREDJENI NAME DO IOO-JA LOAD BALANCER-A (USTVARI OVO JE SAMO DA NE MORAM DA PAMTIM IP LOAD BALANCER, VEC DA KORISTIM NEKI READABLE NAZIV ZA TAJ IP); USMERI PREMA INGRESS CONTROLLER-U, KOJI ONDA DIRECT-UJE TRAFFIC DO APPROPRIATE CLISTER IP SERVICE-A, KOJI SVAKI STOJI IN FRONT OF PODS OF SINGLE MICROSERVICE 

IP LOAD BALANCER-A MOGU NACI U DASBOARD-U U GOOGLE CLOUD-U

VEC STARTINGOM PROJECT-A BIO JE PROVISIONED LOAD BALANCER ZA NAS PROJECT

OTVORI HAMBURGER MENU I UNDER Networking NADJI `Network Services -> Load balancing`

LOAD BALANCER IMA RANDOMLY GENERATED NAME

KLIKNUO SAM NA TO IME I MOGU VIDETI UNDER IP:Port, UPRAVO IP ADRESS

TEBE SAMO ZANIMA IP, PREKOPIRAJ GA

**POSTO SAM GA PREKOPIRAO, SETT-UJEM GA UNDER HOSTS NA MOJOJ LOKALNOJ MACHINE-I**

- `sudo vi /etc/hosts`

```bash
# ZADAO SAM OVO
<ip adresa> microticket.com
```

# SADA MORAMO DA RESTART-UJEMO SKAFFOLD

U TEORIJI TO BI TREBALO DA UZME NAS auth-depl.yaml FILE I DEPLOY-UJE SVE NA GOOGLE CLOUD CLUSTER, I UZECE I SET OF OUR ROUTING RULES I TO CE APPLY-OVATI ON CLUSTER AS WELL

SKAFFOLD CE ATTEMPT-OVATI DA BUILD-UJE IMAGE (TACNIJE TO BI TREBAL ODA RADI GOOGLE CCLOUD BUILD)

I APPLY-OVACE SE INGRESS CONFIG I DEPLOYMENT ZA AUTH, UPRAVO NA MOJ GOOGLE CLOUD CLUSTER

EXECUTE-UJEM SLEDECE, IN ROOT PROJECT DIRECTORY 

- `skaffold dev`

**MEDJUTIM DOSLO JE DO PROBLEMA**

**MISLIM DA SU NEKI PROBLEMI NASTALI JER SAM POGRESIO VERZIJE API U CONFIGURATION FILE-OVIMA** (infra/k8s/ingress-srv.yaml) (PROMENIO SAM I service: SEKCIJU)

**SKAFFOLD SAM DOWNGRADE-OVAO apiVersion   12**

**A DRUGI PROBLEMI SU NASTALI ZA AUTHENTICATION** (MORALO JE OVO `gcloud auth application-default login`)

**DODAVANJE SKAFFOLD SA gcloud components install JE MOZDA BILO SUVISNO (MISLIIM DA SADA IMAS DUPLE VERZIJE ZA skaffold I ZA kubectl)**

UGLAVNOM PRORADILO JE A TI SUTRA OBJASNI GORNJE STVARI
